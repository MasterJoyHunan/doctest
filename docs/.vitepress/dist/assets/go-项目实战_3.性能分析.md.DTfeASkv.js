import{_ as i,c as a,a2 as h,o as n}from"./chunks/framework.DPuwY6B9.js";const g=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"go-项目实战/3.性能分析.md","filePath":"go-项目实战/3.性能分析.md","lastUpdated":1729761429000}'),k={name:"go-项目实战/3.性能分析.md"};function p(t,s,l,e,F,r){return n(),a("div",null,s[0]||(s[0]=[h(`<h3 id="生成性能数据文件" tabindex="-1">生成性能数据文件 <a class="header-anchor" href="#生成性能数据文件" aria-label="Permalink to &quot;生成性能数据文件&quot;">​</a></h3><h4 id="通过命令行生成性能数据文件" tabindex="-1">通过命令行生成性能数据文件 <a class="header-anchor" href="#通过命令行生成性能数据文件" aria-label="Permalink to &quot;通过命令行生成性能数据文件&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> go</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -bench=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;.*&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -cpuprofile</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cpu.profile</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -memprofile</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mem.profile</span></span></code></pre></div><h4 id="通过代码生成性能数据文件" tabindex="-1">通过代码生成性能数据文件 <a class="header-anchor" href="#通过代码生成性能数据文件" aria-label="Permalink to &quot;通过代码生成性能数据文件&quot;">​</a></h4><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">os</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">runtime/pprof</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  cpuOut, _ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> os.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cpu.out&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  defer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cpuOut.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Close</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  pprof.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">StartCPUProfile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cpuOut)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  defer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pprof.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">StopCPUProfile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  memOut, _ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> os.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;mem.out&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  defer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> memOut.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Close</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  defer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pprof.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WriteHeapProfile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(memOut)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Sum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Sum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">b</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="通过net-http-pprof生成性能数据文件" tabindex="-1">通过net/http/pprof生成性能数据文件 <a class="header-anchor" href="#通过net-http-pprof生成性能数据文件" aria-label="Permalink to &quot;通过net/http/pprof生成性能数据文件&quot;">​</a></h4><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">github.com/gin-contrib/pprof</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    route </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> gin.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    pprof.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Register</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(route)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>获取cpu.profile</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://127.0.0.1:8080/debug/pprof/profile</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cpu.profile</span></span></code></pre></div><p>获取 mem.profile</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://127.0.0.1:8080/debug/pprof/heap</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mem.profile</span></span></code></pre></div><h3 id="分析性能" tabindex="-1">分析性能 <a class="header-anchor" href="#分析性能" aria-label="Permalink to &quot;分析性能&quot;">​</a></h3><p>使用go tool pprof [mem|cpu].profile命令来分析 HTTP 接口的 CPU 和内存性能。我们也可以使用命令go tool pprof</p><p>也可以使用命令go tool pprof <a href="http://127.0.0.1:8080/debug/pprof/profile%EF%BC%8C%E6%88%96%E8%80%85go" target="_blank" rel="noreferrer">http://127.0.0.1:8080/debug/pprof/profile，或者go</a> tool pprof <a href="http://127.0.0.1:8080/debug/pprof/heap%EF%BC%8C%E6%9D%A5%E7%9B%B4%E6%8E%A5%E8%BF%9B%E5%85%A5" target="_blank" rel="noreferrer">http://127.0.0.1:8080/debug/pprof/heap，来直接进入</a> pprof 工具的交互 Shell 中。go tool pprof会首先下载并保存 CPU 和内存性能数据文件，然后再分析这些文件。</p><h4 id="常用命令" tabindex="-1">常用命令 <a class="header-anchor" href="#常用命令" aria-label="Permalink to &quot;常用命令&quot;">​</a></h4><p><img src="http://tc.masterjoy.top/typory/d10a2c6cbfa4e35fc4efc9a3760d1b98.jpg" alt="img"></p><p>top命令，可以查看性能样本数据</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pprof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">top</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Showing</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nodes</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> accounting</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 350ms,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 79.55%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 440ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> total</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Showing</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> top</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nodes</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> out</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 47</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      flat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  flat%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   sum%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        cum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   cum%</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     110ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 25.00%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 25.00%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      110ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 25.00%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  runtime.futex</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      70ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 15.91%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 40.91%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       90ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 20.45%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  github.com/marmotedu/iam/internal/apiserver/store/fake.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">policies)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.List</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      40ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  9.09%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 50.00%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       40ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  9.09%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  runtime.epollwait</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      40ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  9.09%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 59.09%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      180ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 40.91%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  runtime.findrunnable</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      30ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  6.82%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 65.91%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       30ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  6.82%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  runtime.write1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      20ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  4.55%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 70.45%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       30ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  6.82%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  runtime.notesleep</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      10ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  2.27%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 72.73%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      100ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 22.73%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  github.com/marmotedu/iam/internal/apiserver/service/v1.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">userService)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.List</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      10ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  2.27%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 75.00%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       10ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  2.27%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  runtime.checkTimers</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      10ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  2.27%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 77.27%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       10ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  2.27%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  runtime.doaddtimer</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      10ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  2.27%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 79.55%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       10ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  2.27%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  runtime.mallocgc</span></span></code></pre></div><ul><li>flat：采样点落在该函数中的总时间。</li><li>flat%：采样点落在该函数中时间的百分比。</li><li>sum%：前面所有行的 flat% 的累加值，也就是上一项的累积百分比。</li><li>cum：采样点落在该函数中的，以及被它调用的函数中的总时间。</li><li>cum%：采样点落在该函数中的，以及被它调用的函数中的总次数百分比。</li><li>函数名。</li></ul><p>执行top命令默认是按flat%排序的，在做性能分析时，我们需要先按照cum来排序</p><p>执行top -cum输出如下：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pprof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">top20</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -cum</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Showing</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nodes</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> accounting</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 280ms,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 63.64%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 440ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> total</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Showing</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> top</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 20</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nodes</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> out</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 47</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      flat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  flat%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   sum%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        cum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   cum%</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     0%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     0%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      320ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 72.73%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  runtime.mcall</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     0%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     0%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      320ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 72.73%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  runtime.park_m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     0%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     0%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      280ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 63.64%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  runtime.schedule</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      40ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  9.09%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  9.09%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      180ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 40.91%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  runtime.findrunnable</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     110ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 25.00%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 34.09%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      110ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 25.00%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  runtime.futex</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      10ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  2.27%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 36.36%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      100ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 22.73%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  github.com/marmotedu/iam/internal/apiserver/service/v1.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">userService)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.List</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     0%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 36.36%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      100ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 22.73%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  github.com/marmotedu/iam/internal/apiserver/service/v1.BenchmarkListUser</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     0%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 36.36%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      100ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 22.73%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  runtime.futexwakeup</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     0%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 36.36%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      100ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 22.73%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  runtime.notewakeup</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     0%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 36.36%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      100ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 22.73%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  runtime.resetspinning</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     0%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 36.36%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      100ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 22.73%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  runtime.startm</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     0%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 36.36%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      100ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 22.73%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  runtime.wakep</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     0%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 36.36%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      100ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 22.73%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  testing.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">B)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.launch</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     0%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 36.36%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      100ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 22.73%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  testing.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">B)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.runN</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      70ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 15.91%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 52.27%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       90ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 20.45%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  github.com/marmotedu/iam/internal/apiserver/store/fake.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">policies)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.List</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      10ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  2.27%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 54.55%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       50ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 11.36%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  runtime.netpoll</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      40ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  9.09%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 63.64%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       40ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  9.09%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  runtime.epollwait</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     0%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 63.64%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       40ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  9.09%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  runtime.modtimer</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     0%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 63.64%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       40ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  9.09%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  runtime.resetForSleep</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     0%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 63.64%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       40ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  9.09%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  runtime.resettimer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (inline)</span></span></code></pre></div><h4 id="输出调用链路图" tabindex="-1">输出调用链路图 <a class="header-anchor" href="#输出调用链路图" aria-label="Permalink to &quot;输出调用链路图&quot;">​</a></h4><p>前提是需要安装 <code>Graphviz</code></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> go</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tool</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pprof</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -svg</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cpu.profile</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cpu.svg</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # svg 格式</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 网络</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> go</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tool</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pprof</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -svg</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:8821/debug/pprof/profile</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cpu.svg</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # svg 格式</span></span></code></pre></div><h4 id="输出火焰图" tabindex="-1">输出火焰图 <a class="header-anchor" href="#输出火焰图" aria-label="Permalink to &quot;输出火焰图&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> go</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tool</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pprof</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -http=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;127.0.0.1:888&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v1.test</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:8821/debug/pprof/heap</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># -http=&quot;127.0.0.1:888&quot; 本机地址，端口不能不占用</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># v1.test 随意</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># http://localhost:8821/debug/pprof/heap profile文件地地址</span></span></code></pre></div>`,27)]))}const E=i(k,[["render",p]]);export{g as __pageData,E as default};
