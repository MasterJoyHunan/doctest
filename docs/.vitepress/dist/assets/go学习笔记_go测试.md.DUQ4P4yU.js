import{_ as i,c as a,a2 as n,o as h}from"./chunks/framework.DPuwY6B9.js";const g=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"go学习笔记/go测试.md","filePath":"go学习笔记/go测试.md","lastUpdated":1729815932000}'),k={name:"go学习笔记/go测试.md"};function t(l,s,p,F,e,d){return h(),a("div",null,s[0]||(s[0]=[n(`<h3 id="基本测试" tabindex="-1">基本测试 <a class="header-anchor" href="#基本测试" aria-label="Permalink to &quot;基本测试&quot;">​</a></h3><p>创建 <code>xxx_test.go</code> 文件，方法使用 <code>Test</code> 开头 执行 <code>go test</code></p><h3 id="覆盖率测试" tabindex="-1">覆盖率测试 <a class="header-anchor" href="#覆盖率测试" aria-label="Permalink to &quot;覆盖率测试&quot;">​</a></h3><p>执行 <code>go test -cover</code> 执行 <code>go test -run=Coverage -coverprofile=c.out</code></p><h3 id="基准测试-方法使用-benchmark-开头" tabindex="-1">基准测试， 方法使用 <code>Benchmark</code> 开头 <a class="header-anchor" href="#基准测试-方法使用-benchmark-开头" aria-label="Permalink to &quot;基准测试， 方法使用 \`Benchmark\` 开头&quot;">​</a></h3><p>执行 <code>go test -bench=.</code> 正则匹配 执行 <code>go test -bench=. -benchmem</code> benchmem参数将统计内存分配统计数据</p><h3 id="性能报告" tabindex="-1">性能报告 <a class="header-anchor" href="#性能报告" aria-label="Permalink to &quot;性能报告&quot;">​</a></h3><p><code>cpu</code> 性能剖析 <code>堆</code> 性能剖析 <code>阻塞</code> 性能剖析 执行 <code>go test -cpuprofile=cpu.out</code> 执行 <code>go test -blockprofile=block.out</code> 执行 <code>go test -memprofile=mem.out</code> 性能报告无法生成同时生成多个，因为机制就是这样的 得到结果之后，需要 <code>go tool pprof</code> 工具分析 使用过滤器 <code>-run=NONE</code> 不测试基准测试</p><p>example:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 获取测试用例的输出文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">go</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -run=NONE</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 不测试基准测试</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-bench</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">TEST_METHOD</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\ </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"># 测试的方法（正则）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-cpuprofile</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">CUP.out</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\ </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"># 输出的文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">net/http</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 测试的包（正则）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 分析</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">go</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tool</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pprof</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-text </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 以文档方式输出</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-nodecount</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">10</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\ </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"># 显示10条数据</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./http.test</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 可执行文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CUP.out</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 分析的文件</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ——————————————————————————— 得到的结果 —————————————————————————</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">File:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http.test</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Type:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cpu</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Time:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Dec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 7,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2019</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> at</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10:44am</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CST)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Duration:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 1.05mins,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Total</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> samples</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 80990ms</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (128.53%)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Showing</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nodes</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> accounting</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 55850ms,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 68.96%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 80990ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> total</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Dropped</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 690</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nodes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cum </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 404.95ms</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Showing</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> top</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nodes</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> out</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 225</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      flat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  flat%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   sum%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        cum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   cum%</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   22600ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 27.90%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 27.90%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    23090ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 28.51%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  syscall.syscall</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   12140ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 14.99%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 42.89%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    12140ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 14.99%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  runtime.pthread_cond_signal</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    7600ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  9.38%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 52.28%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     7600ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  9.38%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  runtime.pthread_cond_wait</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    3780ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  4.67%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 56.95%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     3790ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  4.68%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  runtime.usleep</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    2110ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  2.61%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 59.55%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     2120ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  2.62%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  runtime.kevent</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    1910ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  2.36%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 61.91%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     1910ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  2.36%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  runtime.madvise</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    1810ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  2.23%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 64.14%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     1810ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  2.23%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  syscall.rawSyscall</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    1510ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  1.86%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 66.01%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     1520ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  1.88%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  runtime.nanotime</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    1420ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  1.75%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 67.76%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     1420ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  1.75%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  runtime.pthread_cond_timedwait_relative_np</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     970ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  1.20%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 68.96%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      970ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  1.20%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  runtime.memmove</span></span></code></pre></div>`,10)]))}const y=i(k,[["render",t]]);export{g as __pageData,y as default};
