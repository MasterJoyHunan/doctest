### 存活探针

k8s 可以通过存活探针检查容器是否还在运行。 可以为 pod 中的每个容器单独指定存活探针。 k8s 将定期执行探针，如果探测失败，重新启动容器。

k8s 有以下三种探测容器的机制

* httpGet -- 返回 2xx, 3xx 状态码则为成功， 否则将会重启容器
* TCP -- 与容器指定端口建立 tcp 连接，如果无法连接，则重启容器
* Exec -- 探针在容器内执行任意命令，并检查命令的退出状态码。如果状态码是 0 则探测成功。所有其他状态码都被认为失败。

```yaml
apiVersion: v1
kind: Pod
metadata: 
  name: shttp 
spec: 
  containers:
    - image: w4762061/shttp:v1
      name: shttp
      ports: 
        - containerPort: 8222
          protocol: TCP
      livenessProbe: # 存活探针
      	httpGet:
          path: /health
          port: 8222
        initialDelaySeconds: 15 # 延迟探测，否则有可能程序还在启动中，探针就过来探测，导致无法响应的问题
```

### 就绪探针

Service 在 pod 启动过程中，如果 pod 还无法处理请求（如 java spring 项目启动时间需要 5-30 秒），也会将请求转发至该 pod，会给客户带来糟糕的体验。如果需要杜绝这种情况，可以为你的 pod 准备一个就绪探针

和存活探针一样有3种探测容器的机制，但是不需要设置延迟探测，因为未准备好的 pod 不会被重启，而是 service 不会转发至该 pod， 直至该 pod 已经准备好

默认情况下每**10** 秒检查一次

```yaml
apiVersion: v1
kind: Pod
metadata: 
  name: shttp 
spec: 
  containers:
    - image: w4762061/shttp:v1
      name: shttp
      ports: 
        - containerPort: 8222
          protocol: TCP
      readinessProbe: # 就绪探针
        httpGet:
          path: /probe
          port: 8222
```