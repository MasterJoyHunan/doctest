文档地址：https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/

### POD 装载容器的容器

pod 是 k8s 最核心的东西，一般不直接创建 pod，而是通过 depolyment 创建 rs ，再通过 rs 创建 pod

```yaml
apiVersion: v1
kind: Pod
metadata: # 元数据 
  name: shttp # 名称
  namespace: foo # 命名空间
  labels: # 标签
    beloneApp: testApp
    publishEnv: prod
  annotations: # 注解 
    a: b 
spec: # pod 规格，内容
  nodeSelector: # 希望该 pod 调度到特定的 node
    fastPc: "true"
  containers:
    - image: w4762061/shttp:v1
      name: shttp
      ports: # 声明端口-未声明的端口还是可以访问的
        - containerPort: 8222
          protocol: TCP
```

### 覆盖容器默认命令

command 与 docke 里面的 entrypoint 类似

```yaml
apiVersion: v1
kind: Pod
metadata: 
  name: shttp 
spec:
  containers:
    - image: w4762061/shttp:v2020_11_19_17_30
      name: shttp
      command: ["/bin/command"] # 可以覆盖默认命令
```

### 覆盖容器默认参数

args 与 docke 里面的 cmd 类似

```yaml
apiVersion: v1
kind: Pod
metadata: 
  name: shttp 
spec:
  containers:
    - image: w4762061/shttp:v1
      name: shttp
      args: ["--env", "prod"] # 可以覆盖默认参数
```

### 设置环境变量

```yaml
apiVersion: v1
kind: Pod
metadata: 
  name: shttp 
spec:
  containers:
    - image: w4762061/shttp:v1
      name: shttp
      env: # 设置环境变量
        - name: ENV_KEY # 环境变量 key
          value: ENV_VALUE # 环境变量 value
        - name: ENV_KEY_BAR
          value: $(ENV_KEY)bar # 环境变量引用其他环境变量的值
```

复杂配置使用 configMap 

### init 容器

一个 pod 可以拥有任意数量的 init 容器，init 容器是顺序执行的，当最后一个 init 容器执行完毕才会执行主容器

```yaml
apiVersion: v1
kind: Pod
metadata: 
  name: shttp 
spec:
  initContainers: # init 容器
  - name: init-1
    image: xxx:v1
  - name: init-2
    image: xxx:v2
  containers:
    - image: w4762061/shttp:v1
      name: shttp
```

### 生命钩子

启动后 post start 

停止钱 pre stop

与 init 容器不同，init 容器作用于整个 pod，而生命钩子作用于特定的容器

```yaml
apiVersion: v1
kind: Pod
metadata: 
  name: shttp 
spec:
  containers:
    - image: w4762061/shttp:v1
      name: shttp
      lifecycele:
        postStart:
          exec: 
            command: ["xx", "-x"]
        preStop:
          httpGet: # 会发生请求至 http://POD_IP:8080/stop
            port: 8080
            path: stop
```

