文档地址：https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/downward-api/

### Downward API

对于容器来说，在不与 Kubernetes 过度耦合的情况下，拥有关于自身的信息有时是很有用的。 **Downward API** 允许容器在不使用 Kubernetes 客户端或 API 服务器的情况下获得自己或集群的信息。

#### 环境变量方式

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: pod-downward
spec:
  containers:
    - name: busy-box
      image: w4762061/shttp:v1
      resources:
        requests:
          cpu: 15m
          memory: 100Ki
        limits:
          cpu: 100m
          memory: 4Mi
      env:
        - name: POD_NAME
          valueFrom:
            fieldRef: # fieldRef 可以获取 metadata、spec、status 等资源里面的数据
              fieldPath: metadata.name # 引用 metadata 元数据
        - name: CPU_LIMIT
          valueFrom:
            resourceFieldRef: # 获取 resources 数据需要使用 resourceFieldRef 字段
              resource: limits.cpu
              divisor: 1Ki # 设置获取单位
```

#### 挂载文件方式

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: pod-downward
  labels:
    test-labels: test-labels-value
  annotations:
    test-annotations: test-annotations-value
    test-annotations-arr: |
      aaa
      bbb
      ccc
spec:
  containers:
    - name: busy-box
      image: w4762061/shttp:v1
      resources:
        requests:
          cpu: 15m
          memory: 100Ki
        limits:
          cpu: 100m
          memory: 4Mi
      volumeMounts:
        - name: downward-api
          mountPath: /etc/downward
  volumes:
    - name: downward-api
      downwardAPI:
        items:
          - path: "podName"
            fieldRef:
              fieldPath: metadata.name
          - path: "labels"
            fieldRef:
              fieldPath: metadata.labels
          - path: "annotations"
            fieldRef:
              fieldPath: metadata.annotations
          - path: "requestCpu"
            resourceFieldRef:
              containerName: busy-box
              resource: requests.cpu
              divisor: 1m
          - path: "limitMemory"
            resourceFieldRef:
              containerName: busy-box
              resource: limits.memory
              divisor: 1Ki
```

