文档地址：https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/statefulset/

### StatefuIset 

用来管理有状态应用的工作负载 API 对象

#### 创建控制 Service

```yaml
apiVersion: v1
kind: Service
metadata:
  name: shttp-ss-svc
spec:
  clusterIP: None # StatefuIset 的 service 必须是 headless 的
  selector:
    beloneApp: ss-test-app
  ports:
    - port: 8555
      targetPort: 8222
```

#### 创建 PVC

```yaml
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: shttp-ss-sc
provisioner: docker.io/hostpath
```

#### 创建 StatefuIset 

```yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: shttp-ss
spec:
  replicas: 2
  serviceName: shttp-ss-svc
  template:
    metadata:
      labels:
        beloneApp: ss-test-app
    spec:
      containers:
        - name: shttp
          image: w4762061/shttp:v1
          volumeMounts:
            - name: shttp-ss-pvc
              mountPath: /home/joy/data
  volumeClaimTemplates: # 特别的地方 会依据这个模板为每个pod都创建一个持久卷声明
    - metadata:
        name: shttp-ss-pvc
      spec:
        resources:
          requests:
            storage: 1Mi
        accessModes:
          - ReadWriteOnce
        storageClassName: shttp-ss-sc
```

### 访问某个 statefulset  pod

直接使用 IP 即可，在 Endpoints 找到对应的 IP，statefulset pod 的 IP 是不会变的

### 在pod中获取集群pod

根据 headless svc 创建的 srv 记录来指向 pod 主机名

```go
net.LookupSRV("some", "TCP", "shttp-ss-svc")
```

