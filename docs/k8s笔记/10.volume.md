文档地址：https://kubernetes.io/docs/concepts/storage/volumes/

### 磁盘挂载  pod

在 k8s 上，pod 容器装载的默认是无状态的应用，当 pod 奔溃或停止时，容器生命周期内所创建的文件会被全部删除，k8s 会重新创建一个全新的 pod。在某些情况下，我们需要保留应用在 pod 容器创建的文件，可以使用卷

### EmptyDir 临时卷

用于在同一个 pod 中，多个应用直接互相共享文件数据（一个 pod 可以部署多个应用），emptyDir 卷的生命周期和 pod 生命周期一致，当 pod 被删除，卷数据也会被清空

```yaml
# fortune 应用和 nginx 应用共用同一个 html 卷
apiVersion: v1
kind: Pod
metadata:
  name: pro-1
  labels:
    app: simple-pro
spec:
  containers:
    - name: html-generator
      image: luksa/fortune
      volumeMounts: # fortune 应用使用的所有卷
        - mountPath: /var/htdocs # fortune 应用使用 html 卷，将卷挂载至 /var/htdocs 目录
          name: html 
    - name: web-server
      image: nginx
      ports:
        - containerPort: 80
          protocol: TCP
      volumeMounts: # nginx 应用使用的所有卷
        - mountPath: /usr/share/nginx/html  # nginx 应用使用 html 卷，将卷挂载至 /usr/share/nginx/html 目录
          name: html
  volumes: # 定义数据挂载
    - name: html 
      emptyDir: {}
```

### HostPath  持久卷

大多数 pod 不应该访问节点系统上的任何文件，因为 pod 的调度会随机调到任意节点上。 但是某些系统级别（DaemonSet）的 pod 确实需要读取节点的文件或使用节点文件系统来访问节点设备。 Kubemetes 通过 hostPath 卷实现了这一点。

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: test-pd
spec:
  containers:
  - image: registry.k8s.io/test-webserver
    name: test-container
    volumeMounts:
    - mountPath: /test-pd
      name: test-volume
  volumes:
  - name: test-volume
    hostPath:
      path: /data
```

