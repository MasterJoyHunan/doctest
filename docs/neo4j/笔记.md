### 简介

neo4j 是一个存储图的 nosql 数据库，适用于储存对象之间的关系

### 使用 docker-compose 安装
```yaml
version: '3'

services:
  neo4j:
    image: neo4j
    container_name: neo4j
    ports:
      - "7474:7474"
      - "7687:7687"
    volumes:
      - ./data:/data
      - ./logs:/logs
```

### 增删改查
名词解释
```cql
create (<node-name>:<label-name>{key:value})
```
* node-name：该节点的名称「类似于实例，对该实例进行操作」
* label-name ：该节点的结构「类似于对象」

#### create 「创建」
```cql
# 普通插入
create (s:User{id:1,name:"bobo",sex:1,age,18})

# 插入并查看
create (s:User{id:1,name:"bobo",sex:1,age,18}) return s
```
可以动态的添加属性，无需先创建，插入的时候就自动处理

#### match 「查询」
```cql
# 查询所有
match (s:User) return s

# 查询某个字段
match (s:User) return s.name

# 按条件查询
match (s:User) where s.sex = 1 return s order by s.age desc

# 聚合查询
match (s:User) where s.name is not null return s.sex,count(*)

# union 集合查询 「 union 并集」 「 union all 包括重复行」
match (s:User) where s.age = 1 return s
union
match (s:User) where s.age = 18 return s

# 分页 「 skip 跳过多少条」「 limit 返回多少条」
match (s:User) return s skip 0 limit 10 

# in 查询
match (s:User) where s.id in [1, 2] return s
```

#### 添加关系 (顶点与顶点之间的边)

```cql
# 创建新的顶点和边
create (s:User)-[r:Rlation]->(q:User)

# 将已创建顶点连接边
match (s:User),(m:User)
where s.name = "boob" and m.name = "rmb"
create (s)-[r:Work{pay:"100"}]->(m)
```

#### delete 删除 （注：删除某个顶点的时候有，并且某个顶点有边的话会报错）
```cql
# 删除所有
match (s) delete (s)

# 删除某个顶点
match (s) where name is null delete s

# 删除某个边
match (s:User)-[r]-(q:User) where s.name = "bobo" and q.name = "rmb" delete r
```

#### remove 删除节点属性、标签
```cql
# 删除所有属性
match (s) remove s.name

# 按条件删除某个属性
match (s:User) where s.name = "bobo" remove s.sex

# 删除多个属性
match (s:User) where s.name = "bobo" remove s.sex, s.other

# 删除节点的标签
match (s:User) remove s:Man
```

#### set 设置节点属性、标签
```cql
# 删除所有属性
match (s) set s.name = "doller"

# 按条件删除某个属性
match (s:User) where s.id = 1 set s.name = "doller"
```

#### merge
```cql
# MERGE命令在图中搜索给定模式，如果存在，则返回结果。
# 如果它不存在于图中，则它创建新的节点/关系并返回结果。
merge (s:User{name:"jay"})
```

### 索引
创建索引能更快的查找数据 （基于 lucene 的反向索引）
```cql
create index on :<label_name> (property_name)

# example
# 该示例展示在 label User 为属性 name 创建索引
create index on :User (name)

# 删除索引
drop index on .....
```

### 疑问
* 如何创建双向关系

    Neo4j并不支持双向或者无向的关系
    在Neo4j中，遍历关系的任何一个方向所需的时间是相同的。进一步说，方向可以被完全忽略。因此，当单向的关系可以同时代表另一个方向的关系的时候，没有必要同时创建两个方向的关系。
    