配置项手册：https://istio.io/latest/docs/reference/config/networking/gateway/

### 网关 Gateway

接收传入或传出的 HTTP/TCP 连接

### 典型 Gateway

```yaml
apiVersion: networking.istio.io/v1alpha3
kind: Gateway
metadata:
  name: my-gateway
  namespace: istio-ingress # 可以随意放在哪个命名空间下
spec:
  selector:
    app: istio-ingress # 选择 istio-ingress pod 的 label
  servers:
  - port: # 监听端口
      number: 80
      name: http
      protocol: HTTP
    hosts:
    - uk.bookinfo.com # 监听的域名
    tls:
      httpsRedirect: true # 301 重定向至 433 端口
  - port:
      number: 443
      name: https-443
      protocol: HTTPS
    hosts:
    - uk.bookinfo.com
    tls: # https 配置
      mode: SIMPLE # 模式
      credentialName: some-cert-name # 使用 kubectl create -n istio-ingress secret tls some-cert-name --key=/foo/xxx.key --cert=/bar/xxx.pem 创建
```

### selector 标签选择器

一个或多个标签，指示应用此网关配置的一组工作负载。默认搜索所有命名空。如果选择器为零，则网关将应用于所有工作负载。

### servers 服务器列表

* port 端口
* hosts 域名，服务，可以使用通配符
* tls 证书配置
    * httpsRedirect  -- 301 重定向至 433 端口
    * mode -- 证书模式
    * serverCertificate -- TLS 证书的文件的路径
    * privateKey -- 私钥的文件的路径
    * credentialName --  Kubernetes 上运行的网关，保存 TLS 证书（包括 CA 证书）

一般配置证书的两种方式

```yaml
tls:
  mode: SIMPLE
  credentialName: some-cert-name
  
tls:
  mode: SIMPLE
    serverCertificate: /etc/certs/servercert.pem
    privateKey: /etc/certs/privatekey.pem
```
