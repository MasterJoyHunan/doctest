### 原生的 grpc 的使用

#### 1.定义 proto 文件

```protobuf
syntax = "proto3";

package myrpc;
option go_package="./proto/myrpc";


message Request {
  string ping = 1;
}

message Response {
  string pong = 1;
}

service Myrpc {
  rpc Ping(Request) returns(Response);
}
```

#### 2.生成 go 服务端文件

```go
//go:generate protoc myrpc.proto --go_out=. --go-grpc_out=.
func main() {
	listen, err := net.Listen("tcp", "0.0.0.0:7445")
	if err != nil {
		panic(err)
	}
	server := grpc.NewServer()
	myrpc.RegisterMyrpcServer(server, new(MyService))

	// 用于反射查询该服务所含有的 API (相当于文档信息，可以不添加)
    // 使用 grpcurl 可以查询到对应的服务
	reflection.Register(server)

	err = server.Serve(listen)
	if err != nil {
		panic(err)
	}
}

type MyService struct {
	myrpc.UnimplementedMyrpcServer
}

func (m *MyService) Ping(ctx context.Context, req *myrpc.Request) (resp *myrpc.Response, err error) {
	fmt.Println(req.Ping)
	resp = &myrpc.Response{}
	resp.Pong = "xxxx"
	return resp, nil
}
```

#### 3.客户端使用

```go
func main() {

	dial, err := grpc.Dial("localhost:7445", grpc.WithTransportCredentials(insecure.NewCredentials()))

	if err != nil {
		panic(err)
	}

	client := myrpc.NewMyrpcClient(dial)
	ping, err := client.Ping(context.Background(), &myrpc.Request{Ping: "1"})
	if err != nil {
		log.Fatalln(err)
	}

	fmt.Println(ping.Pong)

	defer dial.Close()
}
```

