### SAGA 事务模式

核心思想：将长事务拆分为多个短事务，由事务管理器负责协调。如果每个短事务都成功，则全局事务就成功，如果某个步骤失败，则根据相反顺序调用一次补偿操作

优点：简单易用，能满足绝大部分业务需求

### 时序图

#### 正常时序图

![image-20240710111631462](http://tc.masterjoy.top/typory/image-20240710111631462.png)

1. 主程序将编排的事务，包括正向操作、反向补偿定义好，提交给事务管理器
2. 事务管理器根据提交的事务调用服务1的正向操作（成功）
3. 事务管理器根据提交的事务调用服务2的正向操作（成功）
4. 成功执行了一次分布式事务

#### 失败时序图

![image-20240710112344350](http://tc.masterjoy.top/typory/image-20240710112344350.png)

1. 主程序将编排的事务，包括正向操作、反向补偿定义好，提交给事务管理器
2. 事务管理器根据提交的事务调用服务1的正向操作（成功）
3. 事务管理器根据提交的事务调用服务2的正向操作（失败）
4. 事务管理器根据提交的事务调用服务2的补偿操作
5. 事务管理器根据提交的事务调用服务1的补偿操作
6. 分布式事务失败

理论上没问题，但是如何处理补偿机制的问题？

1. 正常操作是否执行（成功、失败、正在执行）？
2. 补偿操作如果失败了？
3. 重复执行补偿机制（幂等问题）？

解决上面的问题就需要到子事务屏障技术