```yaml
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: process-exporter
  namespace: istio-system
  labels:
    app: process-exporter
spec:
  selector:
    matchLabels:
      app: process-exporter
  template:
    metadata:
      labels:
        app: process-exporter
    spec:
      hostPID: true
      hostIPC: true
      hostNetwork: true
      containers:
        - name: process-exporter
          image: ncabatoff/process-exporter:0.8.1
          args:
            - -config.path=/config/process-exporter-config.yaml
          resources:
            limits:
              cpu: 200m
              memory: 200Mi
          securityContext:
            runAsNonRoot: true
            runAsUser: 65534
          volumeMounts:
            - name: proc
              mountPath: /proc
            - name: config
              mountPath: /config

      volumes:
        - name: proc
          hostPath:
            path: /proc
        - name: config
          configMap:
            name: process-exporter-config

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: process-exporter-config
  namespace: istio-system
data:
  process-exporter-config.yaml: |-
    process_names:
    - name: "{{.Comm}}"
      cmdline:
        - '.+'
```

promethus 添加抓取配置

```yaml
    - job_name: process-export
      scrape_interval: 30s
      scrape_timeout: 30s
      kubernetes_sd_configs:
      - role: node
      relabel_configs:
      - action: replace
        source_labels: [__address__]
        regex: '(.*):10250'
        replacement: '${1}:9256'
        target_label: __address__
      - action: labelmap
        regex: __meta_kubernetes_node_label_(.+)
      - action: replace
        source_labels: [__meta_kubernetes_node_address_InternalIP]
        target_label: ip
```

